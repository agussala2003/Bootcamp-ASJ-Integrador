<div class="bg-dark h-100 d-flex justify-content-center">
  <div *ngIf="userState == true" class="container py-5 p-md-5">
    <!-- Ruteo -->
    <div class="row">
      <!-- Breadcrumb -->
      <div class="col-12 col-md-9 d-flex align-items-center">
        <a class="text-light text-decoration-none" routerLink="/inicio">Inicio</a>
        <i class='bx bx-chevron-right text-light fs-4' ></i>
        <a class="text-light text-decoration-none" routerLink="/ordenes"
          >Ordenes</a
        >
        <i *ngIf="this.orderViewModel.orderNumber != ''" class="bx bx-chevron-right text-light fs-4"></i>
        <p class="m-0 text-light text-md-nowrap">
          <span *ngIf="this.orderViewModel.orderNumber != ''"
            >Orden {{ this.orderViewModel.orderNumber }}</span
          >
        </p>
      </div>
      <!-- Breadcrumb -->
      <div class="col-12 col-md-3 d-flex justify-content-md-end my-3">
        <a routerLink="/ordenes" class="btn btn-primary">Volver a la lista</a>
      </div>
    </div>
    <!-- Ruteo -->
    <div class="row">
      <div class="row">
        <h3 class="my-3 text-light">Datos Orden</h3>
        <div class="col-12 col-xl-4 col-sm-6 mb-3">
          <div class="card bg-dark border-0">
            <div class="card-content">
              <div class="card-body">
                <div class="d-flex">
                  <div class="text-start text-white overflow-y-auto">
                    <div class="d-flex">
                      <i class='bx bxs-check-circle text-primary fs-4 me-3'></i>
                      <div>
                        <h5 class="m-0">{{ this.orderViewModel.orderNumber }}</h5>
                        <span>Numero de orden</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-12 col-xl-4 col-sm-6 mb-3">
          <div class="card bg-dark border-0">
            <div class="card-content">
              <div class="card-body">
                <div class="d-flex">
                  <div class="text-start text-white overflow-y-auto">
                    <div class="d-flex">
                      <i class='bx bxs-check-circle text-primary fs-4 me-3'></i>
                      <div class="d-flex justify-content-between">
                        <div>
                          <h5 class="text-nowrap m-0">{{ this.orderViewModel.supplier.businessName }}</h5>
                          <span>Proveedor</span>
                        </div>
                        <img src="{{this.orderViewModel.supplier.image}}" style="width: 45px; height: 45px;" class="rounded-1 ms-4" alt="">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-12 col-xl-4 col-sm-6 mb-3">
          <div class="card bg-dark border-0">
            <div class="card-content">
              <div class="card-body">
                <div class="d-flex">
                  <div class="text-start text-white overflow-y-auto">
                    <div class="d-flex">
                      <i class='bx bxs-check-circle text-primary fs-4 me-3'></i>
                      <div>
                        <h5 class="m-0">{{ this.orderViewModel.status.statusName }}</h5>
                        <span>Estado</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-12 col-sm-4 mb-3">
          <div class="card bg-dark border-0">
            <div class="card-content">
              <div class="card-body">
                <div class="d-flex">
                  <div class="text-start text-white overflow-y-auto">
                    <div class="d-flex">
                      <i class='bx bxs-check-circle text-primary fs-4 me-3'></i>
                      <div>
                        <h5 class="m-0">{{ this.orderViewModel.issuanceDate | date: "dd/MM/yyyy" }}</h5>
                        <span>Emision</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-12 col-sm-4 mb-3">
          <div class="card bg-dark border-0">
            <div class="card-content">
              <div class="card-body">
                <div class="d-flex">
                  <div class="text-start text-white overflow-y-auto">
                    <div class="d-flex">
                      <i class='bx bxs-check-circle text-primary fs-4 me-3'></i>
                      <div>
                        <h5 class="m-0">{{ this.orderViewModel.deliveryDate | date: "dd/MM/yyyy" }}</h5>
                        <span>Entrega</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-12 mb-3">
          <div class="card bg-dark border-0">
            <div class="card-content">
              <div class="card-body">
                <div class="d-flex">
                  <div class="text-start text-white overflow-y-auto">
                    <div class="d-flex">
                      <i class='bx bxs-check-circle text-primary fs-4 me-3'></i>
                      <div>
                        <h5 class="m-0">{{ this.orderViewModel.receptionInfo }}</h5>
                        <span>Informacion de recepcion</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <h3 class="text-light my-3">Productos en la orden</h3>
        <div
          *ngFor="let orderDetail of orderDetails"
          class="row p-0 m-0"
        >
          <div class="col-12 col-xl-4 col-sm-6 mb-3">
            <div class="card bg-dark border-0">
              <div class="card-content">
                <div class="card-body">
                  <div class="d-flex">
                    <div class="text-start text-white overflow-y-auto">
                      <div class="d-flex">
                        <i class='bx bxs-check-circle text-primary fs-4 me-3'></i>
                        <div class="d-flex justify-content-between">
                          <div>
                            <h5 class="text-nowrap m-0">{{ orderDetail.product.productName }}</h5>
                            <span>Nombre del producto</span>
                          </div>
                          <img src="{{orderDetail.product.imageUrl}}" style="width: 45px; height: 45px;" class="rounded-1 ms-4" alt="">
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-xl-4 col-sm-6 mb-3">
            <div class="card bg-dark border-0">
              <div class="card-content">
                <div class="card-body">
                  <div class="d-flex">
                    <div class="text-start text-white overflow-y-auto">
                      <div class="d-flex">
                        <i class='bx bxs-check-circle text-primary fs-4 me-3'></i>
                        <div>
                          <h5 class="m-0">{{ orderDetail.quantity }}</h5>
                          <span>Cantidad</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-xl-4 col-sm-6 mb-3">
            <div class="card bg-dark border-0">
              <div class="card-content">
                <div class="card-body">
                  <div class="d-flex">
                    <div class="text-start text-white overflow-y-auto">
                      <div class="d-flex">
                        <i class='bx bxs-check-circle text-primary fs-4 me-3'></i>
                        <div>
                          <h5 class="m-0">{{ orderDetail.subtotal | currency }}</h5>
                          <span>Subtotal</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-12 col-xl-4 col-sm-6 mb-3">
          <div class="card bg-dark border-0">
            <div class="card-content">
              <div class="card-body">
                <div class="d-flex">
                  <div class="text-start text-white overflow-y-auto">
                    <div class="d-flex">
                      <i class='bx bxs-check-circle text-primary fs-4 me-3'></i>
                      <div>
                        <h5 class="m-0">{{ calculateTotal(this.orderViewModel) | currency }}</h5>
                        <span>Total</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Acciones desde el detalle -->
        <div class="d-flex">
          <button *ngIf="this.orderViewModel.active" 
            (click)="deleteOrder(this.orderViewModel.id)"
            class="btn btn-danger me-2"
            >Eliminar</button
          >
          <button *ngIf="this.orderViewModel.active" 
            [routerLink]="['/ordenes/form/', this.orderViewModel.id]"
            class="btn btn-primary me-2"
            >Editar</button
          >
          <button *ngIf="!this.orderViewModel.active" 
          (click)="undeleteOrder(this.orderViewModel.id)"
            class="btn btn-success me-2"
            >Dar de alta</button
          >
        </div>
        <!-- Acciones desde el detalle -->
      </div>
    </div>
  </div>
  <!-- Verificamos el nivel del usuario -->
  <div *ngIf="userState == null" class="container py-5 p-md-5">
    <app-navigation-home></app-navigation-home>
  </div>
  <!-- Verificamos el nivel del usuario -->
</div>
